<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quadratic Variance Model · JuChrom</title><meta name="title" content="Quadratic Variance Model · JuChrom"/><meta property="og:title" content="Quadratic Variance Model · JuChrom"/><meta property="twitter:title" content="Quadratic Variance Model · JuChrom"/><meta name="description" content="Documentation for JuChrom."/><meta property="og:description" content="Documentation for JuChrom."/><meta property="twitter:description" content="Documentation for JuChrom."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="JuChrom logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JuChrom</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../Scans/">Scans</a></li><li><a class="tocitem" href="../ScanSeries/">ScansSeries</a></li><li><a class="tocitem" href="../ScanMatrices/">ScanMatrices</a></li><li><a class="tocitem" href="../loaders/">Loaders</a></li><li><a class="tocitem" href="../convert/">Convert</a></li><li><a class="tocitem" href="../transform/">Transform</a></li><li><a class="tocitem" href="../retention_mapper/">Retention Mapper</a></li><li class="is-active"><a class="tocitem" href>Quadratic Variance Model</a></li><li><a class="tocitem" href="../baseline/">Baseline</a></li><li><a class="tocitem" href="../alignment/">Alignment</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../../internals/transform/">Transform</a></li><li><a class="tocitem" href="../../internals/utils/">Utilities</a></li></ul></li><li><a class="tocitem" href="../register/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Quadratic Variance Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quadratic Variance Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/oniehuis/JuChrom.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/oniehuis/JuChrom.jl/blob/main/docs/src/man/quadvar_model.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quadratic-Variance-Model"><a class="docs-heading-anchor" href="#Quadratic-Variance-Model">Quadratic Variance Model</a><a id="Quadratic-Variance-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Quadratic-Variance-Model" title="Permalink"></a></h1><article><details class="docstring" open="true"><summary id="JuChrom.fitquadvarmodel"><a class="docstring-binding" href="#JuChrom.fitquadvarmodel"><code>JuChrom.fitquadvarmodel</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">fitquadvarmodel(series_batches::AbstractVector{&lt;:AbstractVector};
                mzsel=nothing, show_progress::Bool=true, progress_every::Int=1, kwargs...)</code></pre><p>Fit the signal/offset/gain + quadratic-variance model across a selection of m/z. Returns a <strong>self-contained</strong> <code>QuadVarFit</code> that includes the observed matrices restricted to the selected m/z.</p><p><strong>Arguments</strong></p><ul><li><code>series_batches</code>: vector of batches; each batch is a vector of replicate series. Within a batch, replicates must share the same m/z grid and the same scan count.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>mzsel</code>: m/z selection:<ul><li><code>nothing</code> → all m/z in the reference grid,</li><li>indices (range or <code>Vector{Int}</code>) into <code>mz_ref</code>,</li><li><code>Vector{&lt;:Number}</code> of exact m/z values (unitless numbers interpreted in <code>mz_unit</code>; Unitful quantities are converted to <code>mz_unit</code>) found in <code>mz_ref</code>.</li></ul></li><li><code>show_progress</code> (default <code>true</code>), <code>progress_every</code> (default <code>1</code>).</li><li><code>kwargs...</code> are forwarded to <code>fitquadvarmodel(Ms::Vector{&lt;:AbstractMatrix})</code>.</li></ul><p><strong>Returns</strong></p><p>A <code>QuadVarFit</code> struct containing per-m/z fits and the observed data for the selected m/z.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/fit.jl#L17-L40">source</a></section><section><div><pre><code class="language-julia hljs">fitquadvarmodel(Ms::Vector{&lt;:AbstractMatrix{&lt;:Real}}; kwargs...)</code></pre><p>End-to-end fitting of the <strong>signal/offset/gain + quadratic variance</strong> model via alternating updates with smoothing, ridge regularization, pooled variance re-estimation, optional global scale calibration, and diagnostics.</p><p><strong>Arguments</strong></p><ul><li><code>Ms</code>: list of batches; each <code>Ms[g]</code> is <code>N_g × R_g</code> (N scans, R replicates).</li></ul><p><strong>Keyword arguments</strong></p><p><strong>Signal / offset / gain</strong></p><ul><li><code>λ_signal</code>: smoothing strength on the shared signal.</li><li><code>λ_offset</code>: smoothing (ridge) on offsets via <code>D&#39; D</code>.</li><li><code>gain_ridge</code>: ridge shrinkage of gains toward <code>1</code>.</li><li><code>damping</code>: step size for the signal update in <code>[0, 1]</code>.</li></ul><p><strong>Variance re-fit</strong></p><ul><li><code>quantlevel</code>, <code>bins</code>, <code>var_stat</code>, <code>σ₀²_min</code>, <code>ϕ_min</code>, <code>κ_min</code>, <code>ϕ_ridge</code>, <code>κ_ridge</code>, <code>z_max</code>, <code>c_eps</code>, <code>v_clip_q</code>, <code>z_low_q</code>, <code>feas_tol</code>.</li></ul><p><strong>Floors and jitter</strong></p><ul><li><code>qc_varfloor</code>: variance floor for QC/diagnostics.</li><li><code>τ_floor</code>: fraction to set the adaptive floor from per-batch medians.</li><li><code>varpred_floor</code>: hard floor used inside <code>varpred</code> when forming weights.</li><li><code>chol_jitter</code>: relative diagonal jitter in the offset solver.</li></ul><p><strong>Iteration / stopping</strong></p><ul><li><code>maxiter</code>, <code>var_update_every</code>, <code>obj_reltol</code>.</li></ul><p><strong>Calibration</strong></p><ul><li><code>calibrate_scale</code>, <code>cal_trim_lo</code>, <code>cal_trim_hi</code>, <code>cal_clip_lo</code>, <code>cal_clip_hi</code>.</li></ul><p><strong>Diagnostics</strong></p><ul><li><code>ac_lag::Int=1</code>: residual autocorrelation lag.</li><li><code>acf_restrict::Symbol=:flat</code>: observation mask used for ACF.<ul><li><code>:none</code>     → use all rows</li><li><code>:low</code>      → keep rows with low normalized signal <code>z = s/c′</code></li><li><code>:flat</code>     → keep rows with small local slope (|Δs| below a quantile)</li><li><code>:lowflat</code>  → apply both low and flat masks</li></ul></li><li><code>acf_z_quant::Float64=quantlevel</code>: quantile for pooled scale <code>c′</code> (used only for <code>:low</code>/<code>:lowflat</code>).</li><li><code>acf_z_max_keep::Float64=0.30</code>: keep rows with <code>s/c′ ≤ acf_z_max_keep</code> when low mask is active.</li><li><code>acf_flat_q::Float64=0.20</code>: keep rows where both adjacent |Δs| are ≤ this quantile.</li><li><code>acf_trimfrac::Float64=0.0</code>: fraction of extreme residual pairs to trim when computing ACF.</li></ul><p><strong>Returns</strong></p><p>A named tuple with fields:</p><ul><li><code>params::QuadVarParams</code></li><li><code>s::Vector{Vector{Float64}}</code></li><li><code>o::Vector{Matrix{Float64}}</code></li><li><code>g::Vector{Vector{Float64}}</code></li><li><code>c::Float64</code></li><li><code>stats::NamedTuple</code> with keys <code>z_rms</code>, <code>cov68</code>, <code>cov95</code>, <code>s_min</code>, <code>s_max</code></li><li><code>acf::Float64</code></li><li><code>acf_lag::Int</code></li><li><code>n_pairs::Int</code></li></ul><p><strong>Notes</strong></p><ul><li>Weights use <code>1 ./ max(varpred(s, p; varfloor=varpred_floor), varfloor_eff)</code> with <code>varfloor_eff = max(qc_varfloor, τ_floor * median(per-batch medians))</code>.</li><li>At least one variance update is guaranteed even if the main loop exits early.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/fit.jl#L247-L308">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.QuadVarParams"><a class="docstring-binding" href="#JuChrom.QuadVarParams"><code>JuChrom.QuadVarParams</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">QuadVarParams(σ₀²::Number, ϕ::Number, κ::Number)</code></pre><p>Parameter container for a quadratic variance model of the form</p><pre><code class="language-julia hljs">σ²(y) = σ₀² + ϕ * y + κ * y^2</code></pre><p><strong>Fields</strong></p><ul><li><code>σ₀²</code>: baseline variance (intercept term, shares the variance units).</li><li><code>ϕ</code>: linear coefficient in <code>y</code> (shares the intensity units).</li><li><code>κ</code>: quadratic coefficient in <code>y</code> (dimensionless; multiplies <code>y^2</code>).</li></ul><p><strong>Usage</strong></p><p><code>QuadVarParams</code> is typically used with [<code>varpred</code>] and [<code>varpredbias</code>] to evaluate the variance model given a true or estimated input <code>y</code>. All fields accept plain numbers or <code>Unitful</code> quantities; when intensities have units, set <code>σ₀²</code> and <code>ϕ</code> using the corresponding squared or linear intensity units so predicted variances retain their physical dimensions. The constructor enforces this relationship and also requires <code>κ</code> to remain unitless.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/containers.jl#L3-L22">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.QuadVarFit"><a class="docstring-binding" href="#JuChrom.QuadVarFit"><code>JuChrom.QuadVarFit</code></a> — <span class="docstring-category">Type</span></summary><section><div><pre><code class="language-julia hljs">QuadVarFit()</code></pre><p>Container for fitted <strong>signal/offset/gain + quadratic variance</strong> results across a selected set of m/z values.</p><p><strong>Fields</strong></p><ul><li><code>mz_unit::Union{Unitful.Units, Nothing}</code>: m/z unit tracked from the input grid (or <code>nothing</code> if unitless).</li><li><code>mz_ref::Vector{&lt;:Real}</code>: numeric m/z grid present in the input data (values expressed in <code>mz_unit</code> when that is set).</li><li><code>mz_idx::Vector{Int}</code>: indices into <code>mz_ref</code> that were fitted.</li><li><code>mz_values::Vector{&lt;:Real}</code>: selected m/z values (<code>mz_ref[mz_idx]</code>, numeric).</li><li><code>batchcount::Int</code>: number of batches.</li><li><code>n_reps_per_batch::Vector{Int}</code>: replicates per batch.</li><li><code>n_scans_per_batch::Vector{Int}</code>: scans per batch.</li><li><code>params::Vector{QuadVarParams}</code>: variance parameters per selected m/z.</li><li><code>intensity_unit::Union{Unitful.Units, Nothing}</code>: intensity unit tracked from input data (or <code>nothing</code> if unitless).</li><li><code>signal::Vector{Vector{Vector{Float64}}}</code>: fitted signal per m/z, per batch.</li><li><code>offsets::Vector{Vector{Matrix{Float64}}}</code>: offsets per m/z, per batch.</li><li><code>gains::Vector{Vector{Vector{Float64}}}</code>: gains per m/z, per batch.</li><li><code>scale_c::Vector{Float64}</code>: pooled scale <code>c</code> per m/z.</li><li><code>acf::Vector{Float64}</code>: pooled residual autocorrelation per m/z.</li><li><code>acf_lag::Vector{Int}</code>: lag used for <code>acf</code> (echoed) per m/z.</li><li><code>n_pairs::Vector{Int}</code>: total pairs contributing to <code>acf</code> per m/z.</li><li><code>qc_z_rms::Vector{Float64}</code>: pooled z-RMS per m/z.</li><li><code>qc_cov68::Vector{Float64}</code>: |z|≤1 coverage per m/z.</li><li><code>qc_cov95::Vector{Float64}</code>: |z|≤1.96 coverage per m/z.</li><li><code>qc_s_min::Vector{Float64}</code> / <code>qc_s_max::Vector{Float64}</code>: signal range per m/z.</li><li><code>qc_nz::Vector{Int}</code>: count of finite standardized residuals per m/z.</li><li><code>observed::Vector{Vector{Matrix{Float64}}}</code>: raw data <strong>restricted to selected m/z</strong>, shaped as <code>observed[b][r] :: n_scans_b × n_mz_select</code>.</li></ul><p><strong>Notes</strong></p><ul><li>Use <code>mz_values[j]</code> for labels (multiply by <code>mz_unit</code> to recover Unitful values); use <code>mz_idx[j]</code> if you need to index into a full grid.</li><li><code>observed[b][r][:, j]</code> matches the <strong>j-th selected</strong> m/z (i.e., <code>mz_values[j]</code>).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/containers.jl#L57-L95">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.residautocorr"><a class="docstring-binding" href="#JuChrom.residautocorr"><code>JuChrom.residautocorr</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">residautocorr(Y, o, g, s, varmodel; lag=1, mask=nothing,
              varfloor=1e-12, trimfrac=0.0)</code></pre><p>Compute the lag-<code>lag</code> residual autocorrelation for each replicate series.</p><p><strong>Arguments</strong></p><ul><li><code>Y</code>: data matrix (N × R).</li><li><code>o</code>: offset matrix (N × R).</li><li><code>g</code>: gains vector (length R).</li><li><code>s</code>: shared signal vector (length N).</li><li><code>varmodel</code>: function mapping <code>s</code> → variance.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>lag::Int=1</code>: autocorrelation lag (≥ 1).</li><li><code>mask::Union{Nothing, AbstractVector{Bool}}=nothing</code>: optional observation mask (length N); rows with <code>mask[i] == false</code> are excluded.</li><li><code>varfloor::Float64=1e-12</code>: variance floor to avoid division by zero.</li><li><code>trimfrac::Float64=0.0</code>: fraction (0 ≤ trimfrac &lt; 0.5) of largest standardized residual pairs to trim before computing autocorrelation.</li></ul><p><strong>Returns</strong></p><p>Tuple <code>(ρ_all, ρ_series, n_pairs)</code>:</p><ul><li><code>ρ_all</code>: overall pooled ACF across replicates (Fisher–z weighted).</li><li><code>ρ_series</code>: vector of per-replicate ACF values.</li><li><code>n_pairs</code>: vector of counts of contributing lagged pairs per replicate.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/fit.jl#L1204-L1230">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.varpred"><a class="docstring-binding" href="#JuChrom.varpred"><code>JuChrom.varpred</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">varpred(y, p::QuadVarParams; varfloor::Number=0)</code></pre><p>Evaluate the quadratic variance model <strong>elementwise</strong> using a parameter bundle:</p><pre><code class="language-julia hljs">σ²(y) = p.σ₀² + p.ϕ * y + p.κ * y^2</code></pre><p>Works for scalars, vectors, and matrices via broadcasting.</p><p><strong>Arguments</strong></p><ul><li><code>y</code>: true input value(s) at which to evaluate the variance model (number or array).</li><li><code>p</code>: <code>QuadVarParams</code> with fields <code>σ₀²</code>, <code>ϕ</code>, <code>κ</code>.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>varfloor=0</code>: elementwise lower bound applied to predicted variances; plain numbers are automatically converted to the variance units when <code>σ₀²</code> carries units. Also replaces non-finite results.</li></ul><p><strong>Returns</strong></p><p><code>σ²(y)</code> with the same shape as <code>y</code>. The element type is the promotion of <code>eltype(y)</code>, the parameter field types in <code>p</code>, and <code>typeof(varfloor)</code>.</p><p><strong>Notes</strong></p><ul><li>Non-finite intermediate results are replaced by <code>varfloor</code>.</li><li>Predicted values retain the units implied by <code>σ₀²</code>/<code>ϕ</code>.</li><li>Use this when <code>y</code> is a true (non-estimated) input. For estimated inputs, see [<code>varpredbias</code>].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/containers.jl#L187-L213">source</a></section><section><div><pre><code class="language-julia hljs">varpred(y, σ₀²::Number, ϕ::Number, κ::Number; varfloor::Number=0)</code></pre><p>Evaluate the quadratic variance model <strong>elementwise</strong> with scalar parameters:</p><pre><code class="language-julia hljs">σ²(y) = σ₀² + ϕ * y + κ * y^2</code></pre><p>Works for scalars, vectors, and matrices via broadcasting.</p><p><strong>Arguments</strong></p><ul><li><code>y</code>: true input value(s) (number or array).</li><li><code>σ₀²</code>, <code>ϕ</code>, <code>κ</code>: scalar parameters of the quadratic variance model.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>varfloor=0</code>: elementwise lower bound applied to predicted variances; coerced to the correct units when <code>σ₀²</code> is unitful. Also replaces non-finite results.</li></ul><p><strong>Returns</strong></p><p><code>σ²(y)</code> with the same shape as <code>y</code>. The element type is the promotion of <code>eltype(y)</code>, the parameter types, and <code>typeof(varfloor)</code>.</p><p><strong>Notes</strong></p><ul><li>Non-finite intermediate results are replaced by <code>varfloor</code>.</li><li>Predicted values inherit the units of <code>σ₀²</code>.</li><li>If you have a parameter bundle, use [<code>varpred(y, p::QuadVarParams; varfloor=...)</code>].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/containers.jl#L246-L271">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.varpredbias"><a class="docstring-binding" href="#JuChrom.varpredbias"><code>JuChrom.varpredbias</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">varpredbias(y, p::QuadVarParams; varfloor::Number=0)</code></pre><p>Evaluate the quadratic variance model with a <strong>bias correction</strong> (for estimated <code>y</code>):</p><pre><code class="language-julia hljs">σ²(y) = (p.σ₀² + p.ϕ * y + p.κ * y^2) / (1 + p.κ)</code></pre><p>Works for scalars, vectors, and matrices via broadcasting.</p><p><strong>Arguments</strong></p><ul><li><code>y</code>: estimated input value(s) (number or array).</li><li><code>p</code>: <code>QuadVarParams</code> with fields <code>σ₀²</code>, <code>ϕ</code>, <code>κ</code>.</li></ul><p><strong>Keyword arguments</strong></p><ul><li><code>varfloor=0</code>: elementwise lower bound applied to predicted variances; coercion to the variance units happens automatically when parameters are unitful. Also replaces non-finite results.</li></ul><p><strong>Returns</strong></p><p><code>σ²(y)</code> with the same shape as <code>y</code>. The element type is the promotion of <code>eltype(y)</code>, the parameter field types in <code>p</code>, and <code>typeof(varfloor)</code>.</p><p><strong>Notes</strong></p><ul><li>Non-finite intermediate results are replaced by <code>varfloor</code>.</li><li>Predicted values retain the units implied by <code>σ₀²</code>/<code>ϕ</code>.</li><li>This form assumes <code>1 + p.κ &gt; 0</code> (typically ensured by enforcing <code>κ_min ≥ 0</code>).</li><li>For true (non-estimated) inputs, see [<code>varpred</code>].</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/containers.jl#L278-L305">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.vif"><a class="docstring-binding" href="#JuChrom.vif"><code>JuChrom.vif</code></a> — <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">vif(ρ::Real, n::Integer; ρmax=0.8, nonnegative=true, nmin=1)</code></pre><p>Compute the variance inflation factor (VIF) associated with correlation ρ and sample size n. The factor is defined as</p><pre><code class="language-julia hljs">VIF = 1 + 2 * ρ * (n_eff - 1) / n_eff</code></pre><p>where n_eff = max(n, nmin) ensures a minimum effective sample size.</p><p><strong>Keyword arguments</strong></p><ul><li><code>ρmax</code> (default 0.8): maximum absolute correlation allowed after capping</li><li><code>nonnegative</code> (default true): if true, negative correlations are clipped to 0;  if false, correlations are symmetrically capped in [-ρmax, ρmax]</li><li><code>nmin</code> (default 1): minimum sample size used in n_eff</li></ul><p><strong>Behavior</strong></p><ul><li>Non-finite ρ values (NaN or Inf) are treated as 0</li><li>Correlations are sanitized (clipped and capped) before use</li><li>The result is always ≥ 1 (variance cannot be deflated)</li></ul><p><strong>Returns</strong></p><p>A floating-point variance inflation factor of the same type as ρ.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/2a91f3982fec8acc7ee58edbd091ff13c4b8fea2/src/core/quadvar_model/fit.jl#L1328-L1351">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../retention_mapper/">« Retention Mapper</a><a class="docs-footer-nextpage" href="../baseline/">Baseline »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 9 January 2026 12:10">Friday 9 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
