<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>m/z binning Â· JuChrom.jl</title><meta name="title" content="m/z binning Â· JuChrom.jl"/><meta property="og:title" content="m/z binning Â· JuChrom.jl"/><meta property="twitter:title" content="m/z binning Â· JuChrom.jl"/><meta name="description" content="Documentation for JuChrom.jl."/><meta property="og:description" content="Documentation for JuChrom.jl."/><meta property="twitter:description" content="Documentation for JuChrom.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="JuChrom.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JuChrom.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Core containers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../containers/">Design overview</a></li><li><a class="tocitem" href="../scans/">Scans</a></li><li><a class="tocitem" href="../scanseries/">Scan series</a></li><li><a class="tocitem" href="../scanmatrices/">Scan matrices</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Loaders</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../loaderapi/">Loader API</a></li><li><a class="tocitem" href="../agilentfid/">Agilent FID</a></li><li><a class="tocitem" href="../chemstationms/">Agilent ChemStation MS</a></li><li><a class="tocitem" href="../masshunterms/">Agilent MassHunter MS</a></li><li><a class="tocitem" href="../shimadzums/">Shimadzu MS</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Data processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../alignment/">Alignment</a></li><li><a class="tocitem" href="../baseline/">Baseline</a></li><li><input class="collapse-toggle" id="menuitem-2-3-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3-3"><span class="docs-label">Binning and Gridding</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>m/z binning</a><ul class="internal"><li><a class="tocitem" href="#Rationale"><span>Rationale</span></a></li><li><a class="tocitem" href="#JuChrom-m/z-binning"><span>JuChrom m/z binning</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#m/z-binning-tools"><span>m/z binning tools</span></a></li></ul></li><li><a class="tocitem" href="../binning_gridding/">Retention binning and gridding</a></li></ul></li><li><a class="tocitem" href="../deconvolution/">Deconvolution</a></li><li><a class="tocitem" href="../convert/">Format conversion</a></li><li><input class="collapse-toggle" id="menuitem-2-3-6" type="checkbox"/><label class="tocitem" for="menuitem-2-3-6"><span class="docs-label">Retention mapping</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../mapping_overview/">Overview</a></li><li><a class="tocitem" href="../mapping_tools/">Mapping tools</a></li></ul></li><li><a class="tocitem" href="../scan_timing/">Scan timing</a></li><li><a class="tocitem" href="../transformation/">Transformation</a></li><li><a class="tocitem" href="../transform/">Trimming and Filtering</a></li><li><a class="tocitem" href="../quadvar_model/">Variance modeling</a></li></ul></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../../internals/deconvolution/">Deconvolution</a></li><li><a class="tocitem" href="../../internals/transform/">Transform</a></li><li><a class="tocitem" href="../../internals/utils/">Utilities</a></li></ul></li><li><a class="tocitem" href="../register/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Data processing</a></li><li><a class="is-disabled">Binning and Gridding</a></li><li class="is-active"><a href>m/z binning</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>m/z binning</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/oniehuis/JuChrom.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ï‚›</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/oniehuis/JuChrom.jl/blob/main/docs/src/man/mz_binning.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ï„</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="m/z-binning"><a class="docs-heading-anchor" href="#m/z-binning">m/z binning</a><a id="m/z-binning-1"></a><a class="docs-heading-anchor-permalink" href="#m/z-binning" title="Permalink"></a></h1><h2 id="Rationale"><a class="docs-heading-anchor" href="#Rationale">Rationale</a><a id="Rationale-1"></a><a class="docs-heading-anchor-permalink" href="#Rationale" title="Permalink"></a></h2><p>Mass spectra are measured at high precision, with centroiding yielding continuous m/z values rather than discrete integer bins. In many instruments, centroiding is performed during acquisition such that the detectorâ€™s profile signal is summarized as peak centers and intensities before storage, and scans are therefore stored as sparse peak lists with non-uniform spacing in the m/z domain. Many downstream workflows, however, operate on a fixed m/z grid. Binning consolidates nearby m/z values into shared bins, which reduces spectrum sparsity, stabilizes signal across scans, and makes spectra comparable for alignment, similarity scoring, and matrix-based processing. This discretization is standard in low-resolution GCâ€“MS workflows, where spectra are treated as nominal-mass vectors rather than accurate-mass distributions.</p><p>For unit-mass GCâ€“MS (e.g., quadrupole electron ionization (EI) instruments), spectra are  acquired as centroided floating-point m/z values, whereas interpretation, library matching,  and fingerprinting operate on nominal integer mass channels. As a result, centroid masses  must be mapped onto an integer grid by assigning each measured m/z value to a nominal mass  bin. The physically meaningful placement of such bins is governed by the systematic offset between exact and nominal masses arising from elemental mass defects. Let <span>$w(X)$</span> be the monoisotopic atomic mass of element <span>$X$</span>, and define the elemental mass defect as <span>$\Delta(X) = w(X) - \mathrm{round}(w(X))$</span>. For a fragment ion <span>$Y$</span> with elemental composition <span>$Y = \sum_{i=1}^{r} k_i X_i$</span>, where <span>$X_i$</span> denotes the <span>$i$</span>-th element present, <span>$k_i$</span> is the number of atoms of that element, and <span>$r$</span> is the number of distinct elements in the fragment, the total mass defect is <span>$\Delta(Y) = \sum_{i=1}^{r} k_i \Delta(X_i)$</span>. Because typical GCâ€“EI fragments are composed primarily of C, H, N, and O, with only limited incorporation of heavier heteroatoms, their exact masses are systematically offset from nominal integers but remain well separated from adjacent nominal channels. As a result, mapping floating-point centroid m/z values onto integer mass bins is a natural and physically meaningful discretization step for low-resolution GCâ€“MS.</p><p>From a theoretical perspective, there is no unique binning interval: any asymmetric window that captures the physically plausible mass-defect range and exceeds instrumental centroid uncertainty is acceptable. Accordingly, multiple asymmetric binning schemes are valid in principle. In practice, however, a window spanning <span>$[n-0.3, n+0.7)$</span> around each integer <span>$n$</span> has become the most widely adopted convention in nominal-mass GCâ€“MS workflows. This interval provides sufficient tolerance for mass defect, centroid jitter, and modest mass-axis drift while maintaining clear separation between adjacent nominal channels.</p><h2 id="JuChrom-m/z-binning"><a class="docs-heading-anchor" href="#JuChrom-m/z-binning">JuChrom m/z binning</a><a id="JuChrom-m/z-binning-1"></a><a class="docs-heading-anchor-permalink" href="#JuChrom-m/z-binning" title="Permalink"></a></h2><p>JuChrom provides <a href="#JuChrom.binmzvalues-Tuple{MassScanSeries, Function}"><code>binmzvalues</code></a>, which applies a binning function to the m/z values in each scan of a <code>MassScanSeries</code> and sums intensities within each bin to produce a new <code>MassScanSeries</code> on a consistent grid. By default it uses <a href="#JuChrom.integer"><code>integer</code></a>, which  implements the <span>$[n-0.3, n+0.7)$</span> integer binning convention described above. However, users  can apply <a href="#JuChrom.integer"><code>integer</code></a> with a different offset or supply custom binning functions to  target a different bin width or precision (for example, rounding to a fixed decimal grid).  To enforce a fixed nominal-mass range across runs, you can pass <code>validmzvalues</code> to restrict  the accepted bins; any binned values outside the provided vector are discarded. This is  useful when occasional out-of-range measurements would otherwise introduce extra bins. Once  the m/z values of a <a href="../scanseries/#JuChrom.MassScanSeries"><code>MassScanSeries</code></a> are on a consistent  grid, you can convert the container to a <a href="../scanmatrices/#JuChrom.MassScanMatrix"><code>MassScanMatrix</code></a> with <a href="../convert/#JuChrom.mscanmatrix"><code>mscanmatrix</code></a>. This makes the fixed m/z grid explicit and enables efficient matrix-based workflows (dense or sparse storage, linear algebra, and downstream binning or mapping that operate on matrices).</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><pre><code class="language-julia hljs"># Load JuChrom and the Agilent ChemStation MS loader
using JuChrom
using JuChrom.ChemStationMSLoader

# Load an example Agilent ChemStation GC-MS run
file = joinpath(JuChrom.agilent, &quot;C7-C40_ChemStationMS.D&quot;, &quot;data.ms&quot;)
mss = load(ChemStationMS(file; mode=:ms))

# Unique m/z values before binning
uniquemzvalues(mss)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5176-element Vector{Float32}:
  29.0
  29.1
  29.2
  29.7
  29.8
  29.9
  30.0
  30.1
  30.2
  30.3
   â‹®
 562.1
 562.2
 562.3
 562.4
 562.5
 562.6
 562.7
 562.8
 562.9</code></pre><pre><code class="language-julia hljs"># Bin m/z values with the [n-0.3, n+0.7) convention
mss_mz_binned = binmzvalues(mss)  # Returns new MassScanSeries object

# Unique m/z values after binning
uniquemzvalues(mss_mz_binned)

# Optional conversion to MassScanMatrix for efficient matrix-based workflows
msm = mscanmatrix(mss_mz_binned)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MassScanMatrix with 2405 scans
â”œâ”€ Retention:
â”‚  â”œâ”€ Range: 191941.0 to 1.899047e6 (ms)
â”‚  â””â”€ Type: Float32
â”œâ”€ M/Z values:
â”‚  â”œâ”€ Range: 29 to 563 (unitless)
â”‚  â”œâ”€ Total data points: 535
â”‚  â””â”€ Type: Int64
â”œâ”€ Intensity:
â”‚  â”œâ”€ Range: 0 to 1186816 (unitless)
â”‚  â”œâ”€ Type: Int32
â”‚  â””â”€ MS Level: 1
â””â”€ Annotations:
   â”œâ”€ Instrument:
   â”‚  â”œâ”€ type = MSD 5977B
   â”‚  â”œâ”€ inlet = unknown
   â”‚  â””â”€ method = VM_STD_Auto_SPME.M
   â”œâ”€ Acquisition:
   â”‚  â”œâ”€ datetime = 19 Jun 24  05:06 pm
   â”‚  â”œâ”€ sequence = 0
   â”‚  â”œâ”€ vial = 23
   â”‚  â””â”€ replicate = 0
   â”œâ”€ User: operator = unknown
   â””â”€ Sample:
     â”œâ”€ sample = C7-C40_vial4_dil4_June19_2024
     â””â”€ description = Alkanstandard vial 4 4x verdÃ¼nnt
</code></pre><pre><code class="language-julia hljs"># Keep only nominal masses 29â€“500
mss_mz_binned_fixed = binmzvalues(mss; validmzvalues=29:1:500)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MassScanSeries with 2405 scans
â”œâ”€ Scan type:
â”‚  â””â”€ MassScan{Float32, Unitful.FreeUnits{(ms,), ğ“, nothing}, Vector{Int64}, Nothing, Vector{Int32}, Nothing, Int64, @NamedTuple{}}
â”œâ”€ Retention:
â”‚  â”œâ”€ Range: 191941.0 to 1.899047e6 (ms)
â”‚  â””â”€ Type: Float32
â”œâ”€ M/Z values:
â”‚  â”œâ”€ Range: 29 to 500 (unitless)
â”‚  â”œâ”€ Unique values: 472
â”‚  â””â”€ Type: Int64
â”œâ”€ Intensity:
â”‚  â”œâ”€ Range: 0 to 1186816 (unitless)
â”‚  â”œâ”€ Type: Int32
â”‚  â””â”€ MS Level: 1
â””â”€ Annotations:
   â”œâ”€ Instrument:
   â”‚  â”œâ”€ type = MSD 5977B
   â”‚  â”œâ”€ inlet = unknown
   â”‚  â””â”€ method = VM_STD_Auto_SPME.M
   â”œâ”€ Acquisition:
   â”‚  â”œâ”€ datetime = 19 Jun 24  05:06 pm
   â”‚  â”œâ”€ sequence = 0
   â”‚  â”œâ”€ vial = 23
   â”‚  â””â”€ replicate = 0
   â”œâ”€ User: operator = unknown
   â””â”€ Sample:
     â”œâ”€ sample = C7-C40_vial4_dil4_June19_2024
     â””â”€ description = Alkanstandard vial 4 4x verdÃ¼nnt
</code></pre><h2 id="m/z-binning-tools"><a class="docs-heading-anchor" href="#m/z-binning-tools">m/z binning tools</a><a id="m/z-binning-tools-1"></a><a class="docs-heading-anchor-permalink" href="#m/z-binning-tools" title="Permalink"></a></h2><article><details class="docstring" open="true"><summary id="JuChrom.binmzvalues-Tuple{MassScanSeries, Function}"><a class="docstring-binding" href="#JuChrom.binmzvalues-Tuple{MassScanSeries, Function}"><code>JuChrom.binmzvalues</code></a> â€” <span class="docstring-category">Method</span></summary><section><div><pre><code class="language-julia hljs">binmzvalues(
    series::MassScanSeries,
    mzbin_fn::Function=integer;
    validmzvalues::Union{Nothing, AbstractVector}=nothing
) -&gt; MassScanSeries</code></pre><p>Return a new <code>MassScanSeries</code> with per-scan m/z values grouped by <code>mzbin_fn</code> and intensities summed within each bin. All other fields are copied from the input series. If <code>validmzvalues</code> is provided, only binned m/z values present in <code>validmzvalues</code> are  retained; values that bin outside the accepted set are discarded.</p><p>The output series uses concrete element types inferred from <code>mzbin_fn</code>.</p><p>See also <a href="../scanseries/#JuChrom.AbstractMassScanSeries"><code>AbstractMassScanSeries</code></a>, <a href="../scanseries/#JuChrom.MassScanSeries"><code>MassScanSeries</code></a>, <a href="#JuChrom.integer"><code>integer</code></a>, <a href="../scanseries/#JuChrom.intensities-Tuple{AbstractMassScanSeries, Integer}"><code>intensities</code></a>, <a href="../scanmatrices/#JuChrom.intensityunit-Tuple{AbstractMassScanMatrix}"><code>intensityunit</code></a>, <a href="../scanseries/#JuChrom.mzvalues-Tuple{AbstractMassScanSeries, Integer}"><code>mzvalues</code></a>, <a href="../scanseries/#JuChrom.mzunit-Tuple{AbstractMassScanSeries}"><code>mzunit</code></a>, <a href="../scanseries/#JuChrom.uniquemzvalues-Tuple{AbstractMassScanSeries, Integer}"><code>uniquemzvalues</code></a>, <a href="../scanseries/#JuChrom.scan-Tuple{AbstractScanSeries, Integer}"><code>scan</code></a>, <a href="../scanseries/#JuChrom.scan-Tuple{AbstractScanSeries, Integer}"><code>scans</code></a>.</p><pre><code class="language-julia-repl hljs">julia&gt; scan1 = MassScan(1.0u&quot;s&quot;, [101.2, 101.6, 102.1], [10, 20, 30])
       scan2 = MassScan(1.0u&quot;s&quot;, [100.9, 101.2, 102.6], [20, 5, 30])
       series = MassScanSeries([scan1, scan2]);

julia&gt; binned = binmzvalues(series);

julia&gt; mzvalues(binned, 1)
2-element Vector{Int64}:
 101
 102

julia&gt; intensities(binned, 1)
2-element Vector{Int64}:
 30
 30</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/713ef5253b54b9d5e1e2b12cc567fa43a557d8a4/src/core/transform/binning.jl#L442-L485">source</a></section></details></article><article><details class="docstring" open="true"><summary id="JuChrom.integer"><a class="docstring-binding" href="#JuChrom.integer"><code>JuChrom.integer</code></a> â€” <span class="docstring-category">Function</span></summary><section><div><pre><code class="language-julia hljs">integer(value::Real; offset::Real=0.3) -&gt; Int</code></pre><p>Assigns a real number <code>value</code> to an integer bin such that the integer bin <code>n</code> includes the interval [n - offset, n + (1 - offset)).</p><p>See also <a href="#JuChrom.binmzvalues-Tuple{MassScanSeries, Function}"><code>binmzvalues</code></a>.</p><pre><code class="language-julia hljs">julia&gt; integer(3.2)
3

julia&gt; integer(3.69)
3

julia&gt; integer(3.7)
4

julia&gt; integer(3.7, 0.999)
4

julia&gt; integer(3.7, 1)
ERROR: ArgumentError: `offset` must be in the range [0, 1).</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/oniehuis/JuChrom.jl/blob/713ef5253b54b9d5e1e2b12cc567fa43a557d8a4/src/core/transform/binning.jl#L582-L606">source</a></section></details></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../baseline/">Â« Baseline</a><a class="docs-footer-nextpage" href="../binning_gridding/">Retention binning and gridding Â»</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 24 January 2026 20:47">Saturday 24 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
