<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mapping rational · JuChrom.jl</title><meta name="title" content="Mapping rational · JuChrom.jl"/><meta property="og:title" content="Mapping rational · JuChrom.jl"/><meta property="twitter:title" content="Mapping rational · JuChrom.jl"/><meta name="description" content="Documentation for JuChrom.jl."/><meta property="og:description" content="Documentation for JuChrom.jl."/><meta property="twitter:description" content="Documentation for JuChrom.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="JuChrom.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">JuChrom.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Core containers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Containers/">Design overview</a></li><li><a class="tocitem" href="../Scans/">Scans</a></li><li><a class="tocitem" href="../ScanSeries/">Scan series</a></li><li><a class="tocitem" href="../ScanMatrices/">Scan matrices</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Loaders</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../LoaderAPI/">Loader API</a></li><li><a class="tocitem" href="../AgilentFID/">Agilent FID</a></li><li><a class="tocitem" href="../ChemStationMS/">Agilent ChemStation MS</a></li><li><a class="tocitem" href="../MassHunterMS/">Agilent MassHunter MS</a></li><li><a class="tocitem" href="../ShimadzuMS/">Shimadzu MS</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">Data processing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-2-3-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-3-1"><span class="docs-label">Retention mapping</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Mapping rational</a><ul class="internal"><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../mapping_tools/">Mapping tools</a></li></ul></li><li><a class="tocitem" href="../alignment/">Alignment</a></li><li><a class="tocitem" href="../baseline/">Baseline</a></li><li><a class="tocitem" href="../binning_gridding/">Binning and Gridding</a></li><li><a class="tocitem" href="../convert/">Format conversion</a></li><li><a class="tocitem" href="../transformation/">Transformation</a></li><li><a class="tocitem" href="../transform/">Trimming and Filtering</a></li><li><a class="tocitem" href="../quadvar_model/">Variance modeling</a></li></ul></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../../internals/transform/">Transform</a></li><li><a class="tocitem" href="../../internals/utils/">Utilities</a></li></ul></li><li><a class="tocitem" href="../register/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Data processing</a></li><li><a class="is-disabled">Retention mapping</a></li><li class="is-active"><a href>Mapping rational</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mapping rational</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/oniehuis/JuChrom.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/oniehuis/JuChrom.jl/blob/main/docs/src/man/mapping_rational.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Mapping-rational"><a class="docs-heading-anchor" href="#Mapping-rational">Mapping rational</a><a id="Mapping-rational-1"></a><a class="docs-heading-anchor-permalink" href="#Mapping-rational" title="Permalink"></a></h1><p>Retention mapping converts an irregular axis (time or distance) into a stable, comparable  index so chromatograms from different runs can be aligned, interpolated, and compared on a  common grid. This makes retention behavior reproducible across batches, instruments, and  methods while preserving ordering and monotonicity.</p><p>A continuous, differentiable mapping does more than align coordinates: it enables intensity- aware transforms via the Jacobian. When you warp the axis, the mapping derivative provides a  principled way to rescale intensities so areas and peak shapes remain physically meaningful.  This yields consistent peak integrals across transformed domains, supports smooth  interpolation, and avoids artifacts from piecewise or discontinuous mappings.</p><p>Mapping points are typically collected from standards with known reference positions. A  common example is an n-alkane ladder, which yields paired arrays of retention times and  Kováts retention indices (Kováts 1958). Another example is a curated set of internal  standards (e.g., a few stable compounds spiked into every run), producing matched retention  pairs that anchor the mapping across batches (Skoog et al. 2007).</p><p>JuChrom provides <code>fitmap</code> to infer an empirical, smooth mapping function from these paired  points. The fit constructs a cubic B-spline and chooses the smallest smoothing penalty that  still enforces a strictly increasing curve. Concretely, the objective minimizes squared  residuals plus a curvature penalty based on the spline’s second derivative: large changes  in slope are penalized, which discourages wiggles and yields a smoother, more stable mapping  between anchor points. In parallel, nonnegative first-derivative values are enforced at a  dense grid of points to guarantee monotonicity. This yields a continuous, differentiable,  and invertible function (stored in a <code>RetentionMapper</code>) that supports both forward mapping  and reliable reverse mapping via the monotonic inverse.</p><p>For most users, the primary tuning parameter when applying <code>fitmap</code> is smoothing strength  (λ). Larger values emphasize smoothness over exact fit to the anchor points, while smaller  values track the anchors more tightly. The default automatically searches for the smallest λ  that still yields a strictly monotonic fit.</p><p>JuChrom also includes Makie-based diagnostics for a fitted mapper, so you can inspect the  forward and inverse fits visually. JuChrom reexports Unitful, so unit literals like  <code>u&quot;minute&quot;</code> work without an explicit <code>using Unitful</code>. Example:</p><pre><code class="language-julia hljs"># Load JuChrom
using JuChrom

# Load CairoMakie for plotting
using CairoMakie
CairoMakie.activate!()

# Known mapping points: retention times (minutes) and Kováts indices
retention_times = [
    27.972, 30.043, 32.011, 33.884, 35.679, 37.398, 39.049, 40.636, 42.164,
    43.636, 45.058, 46.431, 47.759, 49.046, 50.296, 51.669, 53.266, 55.149,
]u&quot;minute&quot;
kovats_indices = [
    1800.0, 1900.0, 2000.0, 2100.0, 2200.0, 2300.0, 2400.0, 2500.0, 2600.0,
    2700.0, 2800.0, 2900.0, 3000.0, 3100.0, 3200.0, 3300.0, 3400.0, 3500.0,
]

# Fit a smooth, strictly increasing mapping function
mapper = fitmap(retention_times, kovats_indices)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RetentionMapper with 18 calibration points
├─ Domain A (input):
│  ├─ Range: 27.972 to 55.149 (minute)
│  └─ Type: Float64
├─ Domain B (output):
│  ├─ Range: 1800.0 to 3500.0 (unitless)
│  └─ Type: Float64
├─ Spline:
│  ├─ Order: 4 (cubic)
│  ├─ Knots: 22
│  └─ Coefficients: 22
└─ Fit quality:
   ├─ Min residual: 0.000 
   ├─ Avg residual: 0.000 
   └─ Max residual: 0.000 
</code></pre><p>The printed <code>RetentionMapper</code> summary provides a compact overview. For a closer look, plot the forward and inverse maps (including derivatives) and the residuals.</p><pre><code class="language-julia hljs"># Visual diagnostics (forward/inverse maps and residuals)
fig = plot(mapper; reverse=true, size=(900, 600))
save(&quot;retention_mapper.svg&quot;, fig)</code></pre><p><img src="../retention_mapper.svg" alt/></p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><ul><li>Kováts E (1958): Gas-Chromatographische Charakterisierung organischer Verbindungen. Teil </li></ul><p>1: Retentionsindices aliphatischer Halogenide, Alkohole, Aldehyde und Ketone. Helvetica  Chimica Acta 41: 1915-1932.</p><ul><li>Skoog DA, Holler FJ, Crouch SR (2007): Principles of Instrumental Analysis. 6th ed. Thomson </li></ul><p>Brooks/Cole.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ShimadzuMS/">« Shimadzu MS</a><a class="docs-footer-nextpage" href="../mapping_tools/">Mapping tools »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 12 January 2026 19:27">Monday 12 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
